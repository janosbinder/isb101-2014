---
title: "Tidy data"
subtitle: "The tidyverse and `tidyr`"
author: "Eric Koncina, Aurélien Ginolhac, Roland Krause"
date: "09 January 2018"
output: iosp::ioslides_plus
---

```{block, include = FALSE}
Adapted from the biostat2 tidyverse lecture https://biostat2.uni.lu/lecture02_tidyverse.html
```


```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.align = "center")
library(tidyverse)
```

## Learning objectives
      
### You will learn to: {.box-10 .offset-1 .bg-red .icon}

![](img/00/kt.png)

- know principles of tidy data
- what is the tidyverse
- tidy up data using `tidyr`

## Basic: everything in the data rectangle | with header {.middle}

###{.box-6 .bg-white .offset-3}

![](img/02/data_rectangle.png)

<span class="small">[Jenny Bryan](https://speakerdeck.com/jennybc/data-rectangling) in Jeff Leek [blog post](https://simplystatistics.org/2017/05/24/toward-tidy-analysis/)</span>

## Rationale {.vs3 .build}

> tidy datasets are all alike but every messy dataset is messy in its own way | Hadley Wickham (see `vignette("tidy-data")`) {.col-8 .offset-2 .bg-yellow}

> All happy families are alike; each unhappy family is unhappy in its own way. | Leo Tolstoy, Anna Karenina{.col-8 .offset-2}

## Semantics {.vs2}

### Definitions {.box-8 .offset-2 .bg-blue}

- **Variable**: A quantity, quality, or property that you can measure.
- **Observation**: A set of values that display the relationship between variables. To be an observation, values need to be measured under similar conditions, usually measured on the same observational unit at the same time.
- **Value**: The state of a variable that you observe when you measure it.

<span class = "small">[source: Garret Grolemund](http://garrettgman.github.io/tidying/) and `vignette("tidy-data")`</span> 


## Definition {.vs2}

### Tidy data {.col-8 .offset-2 .box .bg-yellow}

1. Each variable is in its own column
2. Each observation is in its own row
3. Each value is in its own cell

![](img/02/tidy_data.png)

## Bad data exercise {.bg-green .build}

### {.box-10 .offset-1 .bg-gray .icon}

![](img/02/excel_icon.png)

- Open the [`badtable.xlsx` file](data/badtable.xlsx).
- The table lists missense variants in a gene in a group of patients.
- What's wrong with this sheet?
- Which problems are _tidy_ issues?

###{.col-10 .offset-1}

![](img/02/tidy_excelbad.png)

## Bad data exercise | Summary of problems {.bg-green .build}

### {.box-10 .offset-1 .small .bg-white}

Tidy error                    | Tidy violation | Comment
------------------------------|----------------|--------
Patient names                 | No             | Data protection violation
Identical column names        | **Yes**        | Variable error
Inconsistent variables names  | No             | Bad practice
Non-English columns names     | No             | Bad practice
Color coding                  | No             | The horror, the horror
Inconsistent dates            | No             | Use ISO8601 
Multiple columns for one item | **Yes**        | One observation per line
Redundant information         | **Yes**        | Each variable is in its own column
Repeated rows                 | **Yes**        | Each observation is in its own row
Uncoded syndromes             | **Yes**/No     | Each value in its own cell
Unnecessary information       | No             | like _birthdate_, _comments_: bad practice
Name of the table             | No             | You'll see this often


## Bad data exercise | Manual cleaning {.bg-green}

### Clean the "bad table" {.box-8 .offset-2 .bg-white}

- Bring data into shape such that it conforms to tidy data requirements
- Pay attention to details of format, less to actual data
- Do not use **R** for doing the manipulations
  
## Common tidy data violations {.vs3}

### Problems {.box-10 .bg-yellow .offset-1}

- Column headers are values, not variable names (`gather()`)
- Multiple variables stored in one column (`separate()`)
- Variables are stored in both rows and columns (`gather()`-`spread()`)
- Repeated observations (`nest()` or table)
- Multiple types in one table (`dplyr()` data transformation)
- One type in multiple tables (`dplyr()`, combine into single table)

# The tidyverse

![](img/00/logo_tidyverse.png)

## Tidyverse | website: [https://www.tidyverse.org/](https://www.tidyverse.org/) 

### {.box-8 .offset-2 .bg-bluew}

![](img/02/tidyverse_components.png)

## Tidyverse components | Core

### Core {.box .col-6 .offset-3 .bg-blue}

- `ggplot2`, for data visualization
- `dplyr`, for data manipulation
- `tidyr`, for data tidying
- `readr`, for data import
- `purrr`, for functional programming
- `tibble`, for tibbles, a modern re-imagining of data frames


### {.col-6 .offset-3 .small}

source: http://tidyverse.tidyverse.org/. H.Wickham

## Tidyverse components | Extended

### Working with specific types of vectors {.box-6 .bg-blue}

- `hms`, for times
- `stringr`, for strings
- `lubridate`, for date/times
- `forcats`, for factors

###  Modelling {.box-6 .bg-blue}

- `modelr`, for modelling within a pipeline
- `broom`, for models -> tidy data

### Importing other types of data {.box-6 .offset-3 .bg-blue}

- `feather`, to share data
- `haven`, for SPSS, SAS and Stata files
- `httr`, for web apis
- `jsonlite` for JSON
- `readxl`, for `.xls` and `.xlsx` files
- `rvest`, for web scraping
- `xml2`, for XML files

## Tidyverse workflow

### {.box-8 .offset-2 .bg-bluew}

![](img/02/tidyverse_data_science.png)


## Tidyverse criticisms

### It is a R dialect {.box-6 .bg-blue}

<blockquote class="twitter-tweet" data-lang="fr"><p lang="en" dir="ltr"><a href="https://twitter.com/ucfagls">@ucfagls</a> yeah. I think the tidyverse is a dialect. But its accent isn’t so thick</p>&mdash; Hadley Wickham (@hadleywickham) <a href="https://twitter.com/hadleywickham/status/819610201946984451">12 janvier 2017</a></blockquote>
<script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>

### `tidyverse` vs `data.table`{} {.box-6 .bg-blue}

- Regularly debated on [StackOverflow](http://stackoverflow.com/questions/41880796/grouped-multicolumn-gather-with-dplyr-tidyr-purrr).

![](img/02/tidyverse_contreversy.png)

- See the popularity of the [`data.table` versus `dplyr`](http://stackoverflow.com/questions/21435339/data-table-vs-dplyr-can-one-do-something-well-the-other-cant-or-does-poorly) question.

- In summary: [`data.table`](https://github.com/Rdatatable/data.table/wiki) is faster, but for less than $10^7$ rows, negligible.


## Tidyverse criticisms

### {.box-8 .offset-2 .bg-blue}

- still young: changes quickly and drastically. Backward compatibility is not always maintained.
- `tibbles` (enhanced data frames) are nice but a lot of non-tidyverse packages require `matrices`: `rownames` are still an issue.
- Anyway, learning the _tidyverse_ does not prevent to learn _R base_, it helps to get things done early in the process.

## Pipes with magrittr{.build}

### R base {.box-6 .bg-blue .show}

Nesting function calls with a lot of parenthesis

```{r, width = 8}
set.seed(12)
round(mean(rnorm(5)), 2)
```

### The [magrittr](https://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html) pipeline {.box-6 .bg-blue .icon}

![](img/00/magrittr.png)

Gain in lisibility

```{r, width = 8}
set.seed(12)
rnorm(5) %>%
  mean() %>%
  round(2)
```

- developed by Stefan Milton Bache

### Of note{.box-6 .offset-3 .bg-yellow .icon-small}

![](img/00/tip.png)

`%>%` needs to be loaded using either:

```{r, eval = FALSE, width = 8}
library(magrittr)
library(dplyr)
library(tidyverse)
```

## Règles de la tuyauterie

### hrbrmstr's Rules of Piping {.box-8 .offset-2 .bg-yellow}

- The chain should be > 1
- A pipe should be designed to accomplish a unified task
- It's OK to change object class/type/mode
- Pipe operations should be "atomic"
- Be data-source aware
- Pipe (briefly) in pipes
- **Don't be reticent to create new verbs**

source: [Bob Rudis (hrbrmstr) at studio::conf17](https://www.rstudio.com/resources/videos/writing-readable-code-with-pipes/)

# `tidyr`

![](img/00/logo_tidyr.png)

## `tidyr` | introduction

### Tip {.box-5 .bg-yellow .icon-small}

![](img/00/tip.png)

Use the [cheatsheet](https://www.rstudio.com/resources/cheatsheets/)

### {.box-7 .bg-bluew}

![](img/02/tidyr_cheatsheet.jpg)

## Convert long / wide format

### {.box-10 .offset-1 .bg-yellow}

- The wide format is generally **untidy** _but_ found in the majority of datasets
- The **wide** format makes computation on columns sometimes easier

### gather {.box-6 .bg-blue-white .stretch}

![](img/02/tidy_gather_450.png)

### spread {.box-6 .bg-blue-white .stretch}

![](img/02/tidy_spread_450.png)


## Demo with the iris dataset | `gather()`

```{r, message = FALSE, warning = FALSE, title = "From **large to long** with `gather()`"}
library("tidyverse")
iris_melt <- iris %>%
  rownames_to_column(var = "observation") %>%
  as_tibble() %>%
  gather(key = "parameter", value = "value", -Species, -observation)

iris_melt
```

## Demo with the iris dataset | `spread()` {.vs2}

```{r, title = "From **long to large** with `spread()`"}
iris_melt %>%
  spread(parameter, value)
```

## `separate()` and `unite()`{} {.build}

```{r, title = "Demo tibble", row = c(8, 4)}
demo_tibble <- tibble(year  = c(2015, 2014, 2014),
                      month = c(11L, 2L, 4L), # integer vector
                      day   = c(23, 1, 30),
                      value = c("high", "low", "low"))
demo_tibble
```

```{r, title = "`unite()`", width = 6}
demo_tibble_unite <- demo_tibble %>%
  unite(date, c(year, month, day), sep = "-")
demo_tibble_unite
```

```{r, title = "`separate()`", width = 6}
# use **quotes** since we are not refering to objects
demo_tibble_unite %>%
  separate(date, c("year", "month", "day"))
```

# Basic data cleaning

## Separate rows {.build}

### Multiple values per cell {.box-6 .bg-green .stretch}

```{r}
patient_df <- tibble(
    subject_id = 1001:1003, 
    visit_id = c("1,2,3", "1,2", "1"),
    measured = c("9,0, 11", "11, 3" , "12")  )
patient_df
```

Note the incoherent white space

### Combinations of variables {.box-6 .bg-blue .stretch}

```{r}
separate_rows(patient_df,
              visit_id, measured,
              convert = TRUE) # chr -> int
```

### {.box-6 .offset-3 .bg-yellow .icon-small}

![](img/00/tip.png)

To split different variables use `separate()`

## `separate()` | splitting values {.build}

```{r, row = c(8, 4), title = "Demo dataset"}
patient <- tibble(
  subject_id = 1001:1006,
  gender_age = paste(c("m", "f"), floor(runif(6, 21, 65)),
                     sep = "-"))
patient
```

```{r, row = c(8,4), title = "splitting by key-value pairs"}
separate(patient,
         gender_age, c("sex", "age"),
         convert = TRUE)
```

## `separate()` and `unite()` | exercice {.vs1 .build .bg-green}

### create valid dates format YYYY-MM-DD {.box-12 .bg-blue}

<!-- FIXME: date is not valid!!-->

```{r, row = c(8, 4)}
dummy <- data_frame(year = c(2015, 2014, 2014),
                    month = c(11, 2, 4),
                    day = c(23, 1, 30),
                    value = c("high", "low", "low"))
dummy
```

### solution `unite()`  {.box-12 .bg-gray}

```{r, row = c(8, 4)}
dummy %>%
  unite(date,
        year, month, day,
        sep = "-") -> dummy_unite
dummy_unite
```

## `separate()` and `unite()` | exercice { .build .bg-green}


### {.box-6 .offset-3 .bg-bluew .show}

Explode YYYY-MM-DD by the hyphen (`-`).

### solution `separate()` {.box-10 .offset-1 .bg-bluew}

 - Use **quotes** since we are not refering to objects
 - Default split on non-alphanumeric characters 

```{r, row = c(8, 4)}
dummy_unite %>%
  separate(date, c("year", "month", "day"))
```

## Practice time! {.bg-green}

### {.box-10 .offset-1 .bg-bluew}

Type in R console:

```{r, eval = F, echo = FALSE}
library(swirl)
install_course_github("rolandkrause", "isb101", branch = "swirl")
swirl()
```

### {.box-10 .offset-1 .bg-bluew}

Download the `swc` file from [Moodle](https://moodle.uni.lu/) and, to install the course, run the following commands in R (select the file when asked).

```{r, eval = FALSE}
library(swirl)
install_course()
# Cboose the file you just downloaded when asked
```

Choose the "isb101" course and complete the lesson:

- **Tidying Data with tidyr**.

## Wrap up

### We covered: {.box-10 .offset-1 .bg-red .icon}

![](img/00/kt.png)

- tidyverse, introduction
- tidy data
    + <http://tidyr.tidyverse.org/>
    + `vignette("tidy-data")`
- `tidyr`
    + long / wide with `gather()` / `spread()`
    + data cleaning with `separate()` / `unite()`
- switch from `base` to `tidyverse`, [Rajesh Korde, blog' post](http://www.significantdigits.org/2017/10/switching-from-base-r-to-tidyverse/)

### Acknowledgments {.box-4 .offset-3 .bg-yellow}

* Hadley Wickham
* Jeremy Stanley

```{r, echo = FALSE}
knitr::knit_exit()
```



## Fill all combinations

```{r, title = "Demo dataset"}
kelpdf <- tibble(
  Year = c(1999, 2000, 2004, 1999, 2004),
  Taxon = c("Saccharina", "Saccharina", "Saccharina", "Agarum", "Agarum"),
  Abundance = c(4, 5, 2, 1, 8)
)
kelpdf
```


### {.col-4 .offset-8 .small}

example from [imachorda.com](http://www.imachordata.com/you-complete-me/)

## Fill all combinations {.build}

### {.box-6 .offset-3 .bg-green .show}

_Agarum_ was not recorded in 2000

>- how to fill out the missing info?

%end%

```{r, width = 6, class = "offset-3", title = "Use `complete()`"}
complete(kelpdf,
         Year, Taxon)
```

### {.col-4 .offset-8 .small .show}

example from [imachorda.com](http://www.imachordata.com/you-complete-me/)

## Fill all combinations {.build}

### {.box-8 .offset-2 .bg-green .show}

 _Agarum_ was recorded in 2000, but as it was  **absent** no value was reported.

>- how to fill out this info with 0?

%end%

```{r, width = 6, class = "offset-3", title = "Use `complete()` and option `fill`"}
complete(kelpdf,
         Year, Taxon,
         fill = list(Abundance = 0))
```

### {.col-4 .offset-8 .small .show}

example from [imachorda.com](http://www.imachordata.com/you-complete-me/)

## fill all combinations {.build}

### {.box-8 .offset-2 .bg-green .show}

Wait... What happened between 2000 and 2004?\ The absence of  _Agarum_ was not reported... 

>- how to fill out this info with 0s?

%end%

```{r, row = c(7, 5), class = "compact-output", title = "Use `complete()`, option `fill` and helper `full_seq()`"}
complete(kelpdf,
         # helper tidyr::full_seq
         Year = full_seq(Year, period = 1),
         Taxon,
         fill = list(Abundance = 0))
```

### {.col-4 .offset-8 .small .show}

example from [imachorda.com](http://www.imachordata.com/you-complete-me/)




```{r, echo = FALSE}
knitr::knit_exit()

# nesting() example is useless: only a single column...
# nest() should be presented for purrr. Here it makes no sense.
```


## nesting completion | combinations of variables {.build}

### {.box-8 .offset-2 .bg-green .show}

In our previous `patient_df`, do we have all visits per patient?

```{r, class = "compact-output"}
separate_rows(patient_df,
              visit_id, measured,
              convert = TRUE)
```

%end%

```{r, row = c(7, 5), title = "Use `complete()` with the helper `nesting()`", class = "compact-output"}
separate_rows(patient_df,
              visit_id, measured,
              convert = TRUE) -> a#%>% 
  complete(a, subject_id, 
           nesting(visit_id)) #-> patient_complete
patient_complete
```


## How to keep hierachical data in a rectangle? | nesting tables {.build}

### solution: `nest()` {.box-6 .bg-blue}

```{r out.width = '50%'}
patient_complete %>% 
  nest(visit_id, measured) -> patient_nested
patient_nested
```

### Advantages {.box-6 .bg-green .stretch}

 * common data structures are hierarchical, e.g. patient-centric with repeat observations
 * **nesting** allows to store *collapsed* tibbles and simplifies data management
 * **unnesting** unfold the data

### `unnest()` {.box-12 .bg-blue .compact-output}
```{r, row = TRUE}
patient_nested %>% 
  unnest()
```


## better described as grouped data {.vs2}

### `group_by` and `nest()` {.box-12 .bg-blue}
```{r, row = TRUE}
patient_complete %>%
  group_by(subject_id) %>%
  nest(.key = "visit")
```

%end%

- nested column ([list-column](https://github.com/rstudio/cheatsheets/raw/master/old/pdfs/list-columns-cheatsheet.pdf)) is named `data` by default



# Import data using `readr`

## Learning objectives {.vs2}

### You will learn to: {.box-10 .offset-1 .bg-red .icon}

![](img/00/kt.png)

- use `readr` to import your data into _R_
- use the interactive RStudio interface to visualise your data
- appreciate tibbles

## Importing data{.vs3 .build}

###{.box-6 .bg-blue .offset-0 .stretch}

- Represents probably the first step of your work
- R can handle multiple data types
    + flat files (`.csv`, `.tsv`, ...)
    + excel files (`.xls`, `.xlsx`)
    + foreign statistical formats (`.sas` from SAS, `.sav` from SPSS, `.dta` from Stata)
    + databases (SQL, SQLite ...)
    
### Tidyverse implementation {.box-6 .bg-yellow .offset-0 .icon}

![](img/00/logo_tidyverse.png)

- R base already provides functions for text files (_i.e._ `read.csv()`, `read.delim()`)
- tidyverse redefines these functions:
    + **speed**
    + **characters are not coerced to factors by default**
    + generates tibbles

## Tibbles{.build}

### Tibbles{.box-8 .bg-blue .offset-2 .icon}

![](img/00/logo_tibble.png)

- have a refined print method that shows only the first 10 rows.
- show all the columns that fit on screen and list the name of remaining ones.
- each column reports its type.
- makes it much easier to work with large data.

### Hint {.box-6 .offset-3 .bg-yellow .icon-small .vs1}

![](img/00/tip.png)

Use `as_tibble()` to convert a `data.frame` to a tibble

## Tibbles | `tibble` vs `data.frame`

### {.col-8 .offset-2 .compact-output}

```{css, echo = FALSE}
#dfexample > h3 {
  visibility: visible !important;
  opacity: 1 !important;
}
```


```{r dfexample, class = "build", title = "`data.frame`"}
iris
```

## Tibbles | `tibble` vs `data.frame`{} {.build}

### {.col-8 .compact-output}

```{r, title = "`tibble`"}
as_tibble(iris)
```

### {.col-4 .bg-cobalt .compact-output}

```{r, echo = 3, title = "`tibble` adjusts to width"}
options(tibble.width = 30)
old_w = options(width = 30)
as_tibble(iris)
options(tibble.width = NULL)
options(old_w)
```

### tibble printing enhancements {.box-6 .offset-3 .bg-yellow}

- column type is visible
- shows only the first 10 rows
- shows only the columns that fit on the screen

## Create tibbles{.build}

### `tibble()`{} {.box-6 .bg-blue}

- similar to `base::data.frame()` but
    + does not coerce characters to factors
    + does not change column names
    + never uses rownames

%end%

```{r, row = c(6, 6)}
data.frame(`bad name` = 1:4,
           x = rep(letters[1:2], 2)) %>%
  str()
```

```{r, row = c(6, 6)}
tibble(`bad name` = 1:4,
       x = rep(letters[1:2], 2)) %>%
  str()
```

## The tidyverse packages to import your data

### Tidyverse packages to import your data {.box-10 .offset-1 .bg-blue .icon}

![](img/00/logo_readr.png)

Seven file formats are supported by the readr package:

- `read_csv()`: comma separated (CSV) files
- `read_tsv()`: tab separated files
- `read_delim()`: general delimited files
- `read_fwf()`: fixed width files
- `read_table()`: tabular files where colums are separated by white-space.
- `read_log()`: web log files

### readxl {.box-6 .bg-green .icon}

![](img/00/logo_readxl.png)

To import excel files (`.xls` and `.xlsx`):

- `read_excel()`
    + `read_xls()`
    + `read_xlsx()`
    
### haven {.box-6 .bg-red .icon .stretch}

![](img/00/logo_haven.png)

- `read_sas()` for SAS
- `read_sav()` for SPSS
- `read_dta()` for Stata


# Importing flat files

## Reading flat files{.build .bg-green}

```{css, echo = FALSE}
.flatfile pre {
  background: white;
  width: 100%;
}
```


### Flat file example: _mtcars.csv_{.box-10 .offset-1 .bg-bluew .flatfile}

- Create a new project (finding your files will be easier)
- Download the [`mtcars.csv`](data/mtcars.csv) file to your project folder (using your favourite browser)
- Open the file with a text viewer and have a look at its content

```
"mpg","cyl","disp","hp","drat","wt","qsec","vs","am","gear","carb"
21,6,160,110,3.9,2.62,16.46,0,1,4,4
21,6,160,110,3.9,2.875,17.02,0,1,4,4
22.8,4,108,93,3.85,2.32,18.61,1,1,4,1
21.4,6,258,110,3.08,3.215,19.44,1,0,3,1
18.7,8,360,175,3.15,3.44,17.02,0,0,3,2
...
```

## Rstudio data import | interactive call to `readr`

```{css, echo = FALSE}
/* Center two images in boxes*/
.center-pair p {
  display: flex;
  display: -webkit-flex;
}

.center-pair p > img {
  max-width: 45%;
  margin: auto;
}
```

### Import button{.box-8 .offset-2 .bg-blue .center-pair}

- Use the `Import Dataset` button in the upper right panel or click on the file in the lower right panel

![](img/03/rstudio_import_option_1.jpg) ![](img/03/rstudio_import_option_2.jpg)

- Will interactively select the appropriate function
- Copy paste the generated command to your Rmarkdown document

## Exercise {.bg-green}

### Import the `mtcars.csv` dataset {.box-8 .offset-2 .bg-white}

- Use the interactive `Import Dataset` button to import the `mtcars.csv` file.

## Rstudio data import | preview window{.bg-green}

###{.col-10 .offset-1}

![](img/03/rstudio_import_preview.jpg)

## Reading flat files | comma separated values

### `read_csv()`{}{.box-10 .offset-1 .bg-blue}

- to import **comma separated values**
- is able to read **local** and **remote** files
- is able to read compressed files (`.zip`, `.gz`, ...)

## Reading flat files | comma separated values

### {.col-10 .offset-1 .compact-output}

```{r, title = "Using `read_csv()`"}
read_csv("data/mtcars.csv")
```

## Column types

### Column types{.box-7 .bg-blue}

- are guessed from the **1000** first rows
    + adjustable `guess_max` option
- guessed types are displayed as a _message_
- to hide this message:
    + **lazy method 1**: set `message = FALSE` in your rmarkdown chunk option.
    + **lazy method 2**: set `col_types = cols()`
    + It's a **good practice** to **adjust `col_types`** and tell which columns you expect. This allows for example to detect any deviation during the import of an updated dataset.
    
### {.col-5 .stretch}

```{r, echo = FALSE, title = "Message"}
dummy <- readr_example("mtcars.csv") %>% # Generates the path to the example file
  read_csv()
```

## Column types

### The `col_types` argument {.box-8 .offset-2 .bg-blue}

```{r}
read_csv("data/example.csv",
         col_types = cols())
```

- Let's start with a [file](data/example.csv) containing only 3 columns: `animal`, `colour` and `value`
- Column types are specified using the `cols()` function
- Types can be one of `double`, `integer`, `character`, `logical`, `factor`, `date`, `datetime` or `time`

## Column types

```{css, echo = FALSE}
.chunk > .r-output > pre {
  font-size: 14px;
}
```

### Explicit method {.box-6 .bg-blue .col-list .c2}

Using a function defining each type:

- `col_double()`
- `col_integer()`
- `col_character()`
- `col_logical()`
- `col_factor()`
- `col_date()`
- `col_datetime()`
- `col_time()`

Or telling to **guess** or **skip** a column:

- `col_guess()`
- `col_skip()`

### Example {.box-6 .bg-green}

```{r}
read_csv("data/example.csv",
         col_types = cols(
           animal = col_character(),
           colour = col_character(),
           value = col_integer()
         ))
```

### {.box-8 .offset-2 .bg-yellow .icon-small}

![](img/00/tip.png)

Calling `read_csv()` with `col_types = cols()` works and removes the message as it actually keeps guessing by calling `col_guess()`\
`col_types = cols(.default = col_guess())`

## Column types {.build}

### Compact shortcuts {.box-6 .bg-blue .col-list .c2}

Using a single character to define each type:

- `c` = character
- `i` = integer
- `n` = number
- `d` = double
- `l` = logical
- `D` = date
- `T` = date time
- `t` = time

Or telling to **guess** or **skip** a column:

- `?` = guess
- `_` or `-` = skip

### Example {.box-6 .bg-green .stretch}

```{r}
read_csv("data/example.csv",
         col_types = cols(
           animal = "c",
           colour = "c",
           value = "i"
         ))
```

### Even more compact {.box-8 .offset-2 .bg-yellow}

```{r, eval = FALSE}
read_csv("data/example.csv", col_types = "cci")
```

- Use the single character code in the order of appearance of each column

## Exercise {.bg-green .vs3}

```{r, echo = FALSE}
options(tibble.print_min = 4)
```

### Override the detected column types {.box-10 .offset-1 .bg-white}

- import the `example.csv` file **but**
    + **skip** the `colour` column
    + read in the `value` column as **double**

## Exercise {.bg-green}

### {.col-12}

```{r, row = c(9, 3), title = "Answer"}
read_csv("data/example.csv", col_types = cols(animal = col_character(),
                                              colour = col_skip(),
                                              value = col_double()))

read_csv("data/example.csv", col_types = cols(animal = "c",
                                              colour = "_",
                                              value = "d"))

read_csv("data/example.csv", col_types = "c_d")
```

## Column names{.compact-output}

### The `col_names` argument {.box-6 .bg-blue}

- can be either `TRUE`, `FALSE` or a character vector.
- default value is `TRUE`
- if `TRUE`, the first row will be used as column names
- if `FALSE`, names are generated (X1, X2, X3, ...)
- if it is a character vector, it will define the column names

### Example {.box-6 .bg-green}

```{r, message = FALSE}
read_csv("data/example.csv",
         col_names = TRUE)

read_csv("data/example.csv",
         col_names = FALSE)

read_csv("data/example.csv",
         col_names = c("name", "colname", "number"))
```

## Column names

### Hint {.box-10 .offset-1 .bg-yellow .icon-small}

![](img/00/tip.png)

- `col_names` is handy if they are no column names in the file
- If you would like to rename columns, use `dplyr::rename()` (see upcoming `dplyr` lecture).

```{r, message = FALSE}
read_csv("data/example.csv",
         col_names = c("name", "colname", "number"))

read_csv("data/example.csv", col_names = TRUE) %>%
  rename(name = animal,
         colname = colour,
         number = value)
```


## Skipping lines {.compact-output}

```{css, echo = FALSE}
#skip_example > .r-source:not(:nth-last-child(2)), #skip_example > .r-output:not(:nth-last-child(1)) {
  border-bottom: 2px solid #002240;
  padding-bottom: 10px;
}
```

### `skip` argument {.box-4 .offset-1 .bg-blue}

To skip the first _n_ rows

### `n_max` argument {.box-4 .offset-2 .bg-red}

To stop reading after _n_ rows

### Hint {.box-6 .offset-3 .bg-yellow .icon-small}

![](img/00/tip.png)

You might want to adjust `col_names` to get what you want

%end%

```{r skip_example, message = FALSE, row = c(4, 8)}
readr_example("mtcars.csv") %>%
  read_csv(skip = 3,
           n_max = 3,
           col_names = FALSE)

readr_example("mtcars.csv") %>%
  read_csv(skip = 3, n_max = 3,
           col_names = c("mpg", "cyl", "disp", "hp", "drat", "wt", "qsec", "vs", "am", "gear", "carb"))
```


## `readr` functions {.build}

### `read_csv()`{} {.box-4 .bg-gray}

- **Comma** delimited files

![](img/03/readr_read_csv.png)

### `read_csv2()`{} {.box-4 .bg-gray}

- **Semi-colon** delimited files

![](img/03/readr_read_csv2.png)

### `read_tsv()`{} {.box-4 .bg-gray}

- **tab** delimited files

![](img/03/readr_read_fwf_tsv.png)

### `read_delim()`{} {.box-6 .offset-1 .bg-gray .vs2}

- **any delimiter**:

![](img/03/readr_read_delim.png)

```{r, eval = FALSE}
read_delim(file, delim = "|", ...)
```

### `read_fwf()`{} {.box-4 .bg-gray .vs2 .stretch}

- **fixed width** files

![](img/03/readr_read_fwf_tsv.png)

## Wrap up

### You learned to: {.box-10 .offset-1 .bg-red .icon}

![](img/00/kt.png)

- appreciate the tibble printing features
    + **column types** are displayed
- use `readr` to import your flat file data into _R_
    + using the command line
    + using the interactive RStudio interface
- adjust the imported data types

## Before we stop

### Further reading {.box-8 .offset-2 .bg-blue .icon}

![](img/00/book.png)

- [R for Data Science](http://r4ds.had.co.nz/data-import.html)
- <http://readr.tidyverse.org/>
    + `vignette("readr")`
- [Datacamp course](https://www.datacamp.com/courses/importing-data-in-r-part-1)





